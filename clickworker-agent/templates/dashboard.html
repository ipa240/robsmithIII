<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clickworker Agent Monitor - Authorized Research</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header .subtitle {
            color: #666;
            font-size: 14px;
        }

        .warning-banner {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            color: #856404;
        }

        .warning-banner strong {
            display: block;
            margin-bottom: 5px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .status-stopped { background: #dc3545; }
        .status-running { background: #28a745; }
        .status-paused { background: #ffc107; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .metric {
            margin-bottom: 15px;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .metric-value.success { color: #28a745; }
        .metric-value.warning { color: #ffc107; }
        .metric-value.danger { color: #dc3545; }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-start {
            background: #28a745;
            color: white;
        }

        .btn-stop {
            background: #dc3545;
            color: white;
        }

        .btn-pause {
            background: #ffc107;
            color: #333;
        }

        .log-container {
            background: #1e1e1e;
            border-radius: 5px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid transparent;
        }

        .log-entry.INFO { border-color: #17a2b8; color: #17a2b8; }
        .log-entry.SUCCESS { border-color: #28a745; color: #28a745; }
        .log-entry.WARNING { border-color: #ffc107; color: #ffc107; }
        .log-entry.ERROR { border-color: #dc3545; color: #dc3545; }

        .log-timestamp {
            color: #666;
            margin-right: 10px;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-box .label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .job-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .job-item {
            background: #f8f9fa;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #28a745;
        }

        .job-item.rejected {
            border-left-color: #dc3545;
        }

        .job-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .job-item-details {
            font-size: 12px;
            color: #666;
        }

        .security-score {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .security-score.excellent { color: #28a745; }
        .security-score.good { color: #28a745; }
        .security-score.fair { color: #ffc107; }
        .security-score.poor { color: #dc3545; }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ Clickworker Agent Monitoring Dashboard</h1>
            <div class="subtitle">Real-Time Monitoring for Authorized Research & Testing</div>
        </div>

        <div class="warning-banner">
            <strong>‚ö†Ô∏è AUTHORIZED RESEARCH SYSTEM</strong>
            This monitoring dashboard is for authorized internal testing and research purposes only. All activity is logged and monitored.
        </div>

        <!-- Status & Controls -->
        <div class="grid">
            <div class="card">
                <h2>
                    <span class="status-indicator status-stopped" id="statusIndicator"></span>
                    Agent Status
                </h2>
                <div class="metric">
                    <div class="metric-label">Current Status</div>
                    <div class="metric-value" id="agentStatus">STOPPED</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Current Job</div>
                    <div class="metric-value" id="currentJob">None</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Session Duration</div>
                    <div class="metric-value" id="sessionDuration">00:00:00</div>
                </div>
                <div class="controls">
                    <button class="btn btn-start" onclick="controlAgent('start')">‚ñ∂ Start</button>
                    <button class="btn btn-pause" onclick="controlAgent('pause')">‚è∏ Pause</button>
                    <button class="btn btn-stop" onclick="controlAgent('stop')">‚èπ Stop</button>
                </div>
            </div>

            <div class="card">
                <h2>üìä Today's Progress</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="value" id="jobsToday">0</div>
                        <div class="label">Jobs Completed</div>
                    </div>
                    <div class="stat-box">
                        <div class="value" id="earningsSession">$0.00</div>
                        <div class="label">Session Earnings</div>
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-label">Daily Limit Progress (15 max)</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="dailyProgress" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-label">Next Break</div>
                    <div class="metric-value" id="nextBreak" style="font-size: 16px;">Every 3 jobs</div>
                </div>
            </div>

            <div class="card">
                <h2>üí∞ Earnings Summary</h2>
                <div class="metric">
                    <div class="metric-label">Total Jobs Completed</div>
                    <div class="metric-value success" id="totalJobs">0</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Total Earnings</div>
                    <div class="metric-value success" id="totalEarnings">$0.00</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Acceptance Rate</div>
                    <div class="metric-value" id="acceptanceRate">0%</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Captchas Encountered</div>
                    <div class="metric-value" id="captchaCount">0</div>
                </div>
            </div>

            <div class="card">
                <h2>üîê Security Status</h2>
                <div class="security-score excellent" id="securityScore">9.5/10</div>
                <div style="text-align: center; color: #666; font-size: 14px;">Enterprise-Grade Security</div>
                <div style="margin-top: 20px; font-size: 12px; color: #666;">
                    ‚úÖ 13 Anti-Fingerprinting Layers<br>
                    ‚úÖ Behavioral Anti-Detection<br>
                    ‚úÖ Session Management Active<br>
                    ‚úÖ Payment Tracking Enabled
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid">
            <div class="card" style="grid-column: 1 / -1;">
                <h2>üìà Earnings Chart (Last 7 Days)</h2>
                <div class="chart-container">
                    <canvas id="earningsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Jobs & Logs -->
        <div class="grid">
            <div class="card">
                <h2>üìã Recent Jobs</h2>
                <div class="job-list" id="recentJobs">
                    <div style="text-align: center; color: #666; padding: 20px;">
                        No jobs completed yet
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìù Live Event Log</h2>
                <div class="log-container" id="logContainer">
                    <div class="log-entry INFO">
                        <span class="log-timestamp">[--:--:--]</span>
                        Monitoring dashboard initialized...
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            Clickworker Agent Monitoring Dashboard v1.0 | For Authorized Research & Testing Only<br>
            Security Rating: 9.5/10 (Enterprise-Grade) | Last Updated: <span id="lastUpdate">--:--:--</span>
        </div>
    </div>

    <script>
        // Connect to WebSocket
        const socket = io();

        // State
        let agentState = {};
        let earningsChart = null;

        // Initialize
        socket.on('connect', () => {
            console.log('Connected to monitoring server');
            addLog('INFO', 'Connected to monitoring server');
            socket.emit('request_update');
            loadStats();
            loadEvents();
        });

        // Handle state updates
        socket.on('state_update', (state) => {
            agentState = state;
            updateDashboard(state);
        });

        // Handle events
        socket.on('event', (event) => {
            addLog(event.level, `[${event.type}] ${event.message}`, event.timestamp);
        });

        // Update dashboard
        function updateDashboard(state) {
            // Status
            document.getElementById('agentStatus').textContent = state.status.toUpperCase();
            document.getElementById('statusIndicator').className = `status-indicator status-${state.status}`;

            // Current job
            document.getElementById('currentJob').textContent = state.current_job || 'None';

            // Session duration
            if (state.session_start && state.status === 'running') {
                updateSessionDuration(state.session_start);
            }

            // Jobs today
            document.getElementById('jobsToday').textContent = state.jobs_today;

            // Earnings
            document.getElementById('earningsSession').textContent = `$${state.earnings_session.toFixed(2)}`;

            // Daily progress
            const progress = (state.jobs_today / 15) * 100;
            document.getElementById('dailyProgress').style.width = `${Math.min(progress, 100)}%`;
            document.getElementById('dailyProgress').textContent = `${state.jobs_today}/15`;

            // Captchas
            document.getElementById('captchaCount').textContent = state.captcha_count;

            // Last update
            document.getElementById('lastUpdate').textContent = state.last_activity || '--:--:--';
        }

        // Update session duration
        function updateSessionDuration(startTime) {
            const start = new Date(startTime);
            const now = new Date();
            const diff = now - start;

            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);

            document.getElementById('sessionDuration').textContent =
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            if (agentState.status === 'running') {
                setTimeout(() => updateSessionDuration(startTime), 1000);
            }
        }

        // Control agent
        async function controlAgent(action) {
            try {
                const response = await fetch(`/api/control/${action}`, { method: 'POST' });
                const data = await response.json();
                addLog(data.success ? 'SUCCESS' : 'ERROR', data.message);
            } catch (error) {
                addLog('ERROR', `Failed to ${action} agent: ${error.message}`);
            }
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                document.getElementById('totalJobs').textContent = stats.total_jobs;
                document.getElementById('totalEarnings').textContent = `$${stats.total_earnings.toFixed(2)}`;
                document.getElementById('acceptanceRate').textContent = `${stats.acceptance_rate.toFixed(1)}%`;

                // Update acceptance rate color
                const rateElement = document.getElementById('acceptanceRate');
                if (stats.acceptance_rate >= 95) rateElement.classList.add('success');
                else if (stats.acceptance_rate >= 85) rateElement.classList.add('warning');
                else rateElement.classList.add('danger');

                // Update recent jobs
                updateRecentJobs(stats.recent_jobs);

                // Update earnings chart
                updateEarningsChart(stats.earnings_by_day);
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Update recent jobs list
        function updateRecentJobs(jobs) {
            const container = document.getElementById('recentJobs');
            if (jobs.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No jobs completed yet</div>';
                return;
            }

            container.innerHTML = jobs.map(job => `
                <div class="job-item ${job.accepted ? '' : 'rejected'}">
                    <div class="job-item-header">
                        <strong>Job #${job.job_number}</strong>
                        <span style="color: #28a745; font-weight: bold;">$${job.compensation.toFixed(2)}</span>
                    </div>
                    <div class="job-item-details">
                        ${job.timestamp} | Duration: ${job.duration.toFixed(1)}s | ${job.accepted ? '‚úÖ Accepted' : '‚ùå Rejected'}
                    </div>
                </div>
            `).join('');
        }

        // Update earnings chart
        function updateEarningsChart(data) {
            const ctx = document.getElementById('earningsChart').getContext('2d');

            if (earningsChart) {
                earningsChart.destroy();
            }

            earningsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [{
                        label: 'Daily Earnings ($)',
                        data: data.map(d => d.earnings),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load events
        async function loadEvents() {
            try {
                const response = await fetch('/api/events?limit=20');
                const events = await response.json();
                events.reverse().forEach(event => {
                    addLog(event.level, `[${event.type}] ${event.message}`, event.timestamp);
                });
            } catch (error) {
                console.error('Failed to load events:', error);
            }
        }

        // Add log entry
        function addLog(level, message, timestamp = null) {
            const container = document.getElementById('logContainer');
            const time = timestamp || new Date().toLocaleTimeString();

            const entry = document.createElement('div');
            entry.className = `log-entry ${level}`;
            entry.innerHTML = `<span class="log-timestamp">[${time}]</span>${message}`;

            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;

            // Keep only last 50 entries
            while (container.children.length > 50) {
                container.removeChild(container.firstChild);
            }
        }

        // Refresh stats periodically
        setInterval(loadStats, 5000);
    </script>
</body>
</html>
